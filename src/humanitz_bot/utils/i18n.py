from __future__ import annotations

from typing import Any

_STRINGS: dict[str, dict[str, str]] = {
    "en": {
        "status.online": "ðŸŸ¢ Online",
        "status.offline": "ðŸ”´ Offline",
        "status.server_info": "ðŸ“‹ Server Info",
        "status.season": "Season",
        "status.weather": "Weather",
        "status.game_time": "Game Time",
        "status.connect_info": "ðŸ”— Connect",
        "status.players": "ðŸ‘¥ Players",
        "status.online_players": "Online Players",
        "status.ai_status": "ðŸ§Ÿ AI Status",
        "status.zombies": "Zombies",
        "status.bandits": "Bandits",
        "status.animals": "Animals",
        "status.system_status": "ðŸ“Š System Status",
        "status.cpu": "CPU",
        "status.memory": "Memory",
        "status.disk": "Disk",
        "status.network": "Network",
        "status.uptime": "Uptime",
        "status.death_count": "ðŸ’€ Deaths ({hours}h)",
        "status.death_count_value": "**{count}** player deaths",
        "status.last_update": "Last Update",
        "chat.joined": "ðŸ“¥ **{name}** joined the server",
        "chat.left": "ðŸ“¤ **{name}** left the server",
        "chat.died": "ðŸ’€ **{name}** died",
        "chart.title": "Player Count (24h)",
        "chart.ylabel": "Players",
        "season.Spring": "Spring",
        "season.Summer": "Summer",
        "season.Autumn": "Autumn",
        "season.Fall": "Fall",
        "season.Winter": "Winter",
        "weather.Clear": "Clear",
        "weather.Partly Cloudy": "Partly Cloudy",
        "weather.Overcast": "Overcast",
        "weather.Foggy": "Foggy",
        "weather.Light Rain": "Light Rain",
        "weather.Rain": "Rain",
        "weather.Thunder": "Thunder",
        "weather.Light Snow": "Light Snow",
        "weather.Snow": "Snow",
        "weather.Blizzard": "Blizzard",
        "weather.Cloudy": "Cloudy",
        "weather.Storm": "Storm",
        "weather.Fog": "Fog",
        # --- log / error ---
        "log.rcon_tcp_connected": "RCON TCP connected: %s:%d",
        "log.rcon_connect_failed": "RCON connection failed: %s:%d - %s",
        "log.rcon_auth_packet_sent": "Sent AUTH packet, id=%d",
        "log.rcon_auth_success": "RCON authentication successful",
        "log.rcon_auth_success_id": "RCON authentication successful (resp_id=%d)",
        "log.rcon_auth_failed": "RCON authentication failed: resp_id=%d",
        "log.rcon_auth_read_timeout": "AUTH read #%d timed out",
        "log.rcon_auth_no_response": "RCON authentication failed: no AUTH_RESPONSE received",
        "log.rcon_command_sent": "Sent command: %r (id=%d)",
        "log.rcon_read_error": "Error reading response: %s",
        "log.rcon_command_result": "Command %r: received %d packet(s), response length=%d",
        "log.rcon_connection_closed": "RCON connection closed",
        "log.rcon_connecting": "Attempting RCON connection: %s:%d",
        "log.rcon_connected": "RCON connection established",
        "log.rcon_reconnect_backoff": "RCON connection failed, next retry in %ds",
        "log.rcon_command_failed": "RCON command failed (%s): %s",
        "log.rcon_fetch_interrupted": "fetch_all interrupted: %s",
        "log.rcon_service_closed": "RconService connection closed",
        "log.player_log_not_found": "Log file not found: %s",
        "log.player_log_read_error": "Failed to read log file: %s",
        "log.player_time_parse_error": "Failed to parse time: date=%s time=%s",
        "log.player_not_found_in_log": "Players not found in log tail: %s",
        "log.chart_generation_failed": "Chart generation failed",
        "error.rcon_not_connected": "Not connected",
        "error.rcon_connection_closed": "Connection closed",
        "error.rcon_not_connected_call_connect": "Not connected, call connect() first",
        "log.rcon_connection_failed": "RCON connection failed",
    },
    "zh-TW": {
        "status.online": "ðŸŸ¢ ç·šä¸Š",
        "status.offline": "ðŸ”´ é›¢ç·š",
        "status.server_info": "ðŸ“‹ ä¼ºæœå™¨è³‡è¨Š",
        "status.season": "å­£ç¯€",
        "status.weather": "å¤©æ°£",
        "status.game_time": "éŠæˆ²æ™‚é–“",
        "status.connect_info": "ðŸ”— é€£ç·šè³‡è¨Š",
        "status.players": "ðŸ‘¥ çŽ©å®¶äººæ•¸",
        "status.online_players": "ç·šä¸ŠçŽ©å®¶",
        "status.ai_status": "ðŸ§Ÿ AI ç‹€æ…‹",
        "status.zombies": "æ®­å±",
        "status.bandits": "ç›œè³Š",
        "status.animals": "å‹•ç‰©",
        "status.system_status": "ðŸ“Š ç³»çµ±ç‹€æ…‹",
        "status.cpu": "è™•ç†å™¨",
        "status.memory": "è¨˜æ†¶é«”",
        "status.disk": "ç£ç¢Ÿ",
        "status.network": "ç¶²è·¯",
        "status.uptime": "å·²é‹è¡Œ",
        "status.death_count": "ðŸ’€ æ­»äº¡çµ±è¨ˆï¼ˆ{hours}hï¼‰",
        "status.death_count_value": "**{count}** æ¬¡çŽ©å®¶æ­»äº¡",
        "status.last_update": "æœ€å¾Œæ›´æ–°",
        "chat.joined": "ðŸ“¥ **{name}** åŠ å…¥äº†ä¼ºæœå™¨",
        "chat.left": "ðŸ“¤ **{name}** é›¢é–‹äº†ä¼ºæœå™¨",
        "chat.died": "ðŸ’€ **{name}** æ­»äº¡äº†",
        "chart.title": "çŽ©å®¶äººæ•¸ï¼ˆ24 å°æ™‚ï¼‰",
        "chart.ylabel": "äººæ•¸",
        "season.Spring": "æ˜¥å¤©",
        "season.Summer": "å¤å¤©",
        "season.Autumn": "ç§‹å¤©",
        "season.Fall": "ç§‹å¤©",
        "season.Winter": "å†¬å¤©",
        "weather.Clear": "æ™´æœ—",
        "weather.Partly Cloudy": "å¤šé›²æ™‚æ™´",
        "weather.Overcast": "é™°å¤©",
        "weather.Foggy": "å¤§éœ§",
        "weather.Light Rain": "å°é›¨",
        "weather.Rain": "ä¸‹é›¨",
        "weather.Thunder": "é›·é›¨",
        "weather.Light Snow": "å°é›ª",
        "weather.Snow": "ä¸‹é›ª",
        "weather.Blizzard": "æš´é¢¨é›ª",
        "weather.Cloudy": "å¤šé›²",
        "weather.Storm": "æš´é¢¨é›¨",
        "weather.Fog": "éœ§",
        # --- log / error ---
        "log.rcon_tcp_connected": "RCON TCP é€£ç·šæˆåŠŸ: %s:%d",
        "log.rcon_connect_failed": "RCON é€£ç·šå¤±æ•—: %s:%d - %s",
        "log.rcon_auth_packet_sent": "é€å‡º AUTH å°åŒ…, id=%d",
        "log.rcon_auth_success": "RCON èªè­‰æˆåŠŸ",
        "log.rcon_auth_success_id": "RCON èªè­‰æˆåŠŸ (resp_id=%d)",
        "log.rcon_auth_failed": "RCON èªè­‰å¤±æ•—: resp_id=%d",
        "log.rcon_auth_read_timeout": "AUTH è®€å– #%d è¶…æ™‚",
        "log.rcon_auth_no_response": "RCON èªè­‰å¤±æ•—: æœªæ”¶åˆ° AUTH_RESPONSE",
        "log.rcon_command_sent": "é€å‡ºæŒ‡ä»¤: %r (id=%d)",
        "log.rcon_read_error": "è®€å–å›žæ‡‰æ™‚ç™¼ç”ŸéŒ¯èª¤: %s",
        "log.rcon_command_result": "æŒ‡ä»¤ %r: æ”¶åˆ° %d å€‹å°åŒ…, å›žæ‡‰é•·åº¦=%d",
        "log.rcon_connection_closed": "RCON é€£ç·šå·²é—œé–‰",
        "log.rcon_connecting": "å˜—è©¦å»ºç«‹ RCON é€£ç·š: %s:%d",
        "log.rcon_connected": "RCON é€£ç·šå·²å»ºç«‹",
        "log.rcon_reconnect_backoff": "RCON é€£ç·šå¤±æ•—ï¼Œä¸‹æ¬¡é‡è©¦å»¶é² %ds",
        "log.rcon_command_failed": "RCON æŒ‡ä»¤åŸ·è¡Œå¤±æ•— (%s): %s",
        "log.rcon_fetch_interrupted": "fetch_all åŸ·è¡Œä¸­æ–·: %s",
        "log.rcon_service_closed": "RconService é€£ç·šå·²é—œé–‰",
        "log.player_log_not_found": "æ—¥èªŒæª”æ¡ˆä¸å­˜åœ¨: %s",
        "log.player_log_read_error": "ç„¡æ³•è®€å–æ—¥èªŒ: %s",
        "log.player_time_parse_error": "ç„¡æ³•è§£æžæ™‚é–“: date=%s time=%s",
        "log.player_not_found_in_log": "ä»¥ä¸‹çŽ©å®¶åœ¨æ—¥èªŒå°¾ç«¯æ‰¾ä¸åˆ° Connected è¨˜éŒ„: %s",
        "log.chart_generation_failed": "ç”Ÿæˆåœ–è¡¨å¤±æ•—",
        "error.rcon_not_connected": "æœªå»ºç«‹é€£ç·š",
        "error.rcon_connection_closed": "é€£ç·šå·²é—œé–‰",
        "error.rcon_not_connected_call_connect": "æœªå»ºç«‹é€£ç·šï¼Œè«‹å…ˆå‘¼å« connect()",
        "log.rcon_connection_failed": "RCON é€£ç·šå¤±æ•—",
    },
}

_current_locale: str = "en"


def set_locale(locale: str) -> None:
    global _current_locale
    if locale not in _STRINGS:
        raise ValueError(f"Unsupported locale: {locale}. Available: {list(_STRINGS)}")
    _current_locale = locale


def t(key: str, **kwargs: Any) -> str:
    table = _STRINGS.get(_current_locale, _STRINGS["en"])
    text = table.get(key) or _STRINGS["en"].get(key, key)
    if kwargs:
        return text.format(**kwargs)
    return text
