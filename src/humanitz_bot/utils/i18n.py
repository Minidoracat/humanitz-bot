from __future__ import annotations

from typing import Any

_STRINGS: dict[str, dict[str, str]] = {
    "en": {
        "status.online": "ðŸŸ¢ Online",
        "status.offline": "ðŸ”´ Offline",
        "status.server_info": "ðŸ“‹ Server Info",
        "status.season": "Season",
        "status.weather": "Weather",
        "status.game_time": "Game Time",
        "status.connect_info": "ðŸ”— Connect",
        "status.players": "ðŸ‘¥ Players",
        "status.online_players": "Online Players",
        "status.ai_status": "ðŸ§Ÿ AI Status",
        "status.zombies": "Zombies",
        "status.bandits": "Bandits",
        "status.animals": "Animals",
        "status.system_status": "ðŸ“Š System Status",
        "status.cpu": "CPU",
        "status.memory": "Memory",
        "status.disk": "Disk",
        "status.network": "Network",
        "status.uptime": "Uptime",
        "status.death_count": "ðŸ’€ Deaths ({hours}h)",
        "status.death_count_value": "**{count}** player deaths",
        "status.last_update": "Last Update",
        "chat.joined": "ðŸ“¥ **{name}** joined the server",
        "chat.left": "ðŸ“¤ **{name}** left the server",
        "chat.died": "ðŸ’€ **{name}** died",
        "chart.title": "Player Count (24h)",
        "chart.ylabel": "Players",
        "season.Spring": "Spring",
        "season.Summer": "Summer",
        "season.Autumn": "Autumn",
        "season.Fall": "Fall",
        "season.Winter": "Winter",
        "weather.Clear": "Clear",
        "weather.Partly Cloudy": "Partly Cloudy",
        "weather.Overcast": "Overcast",
        "weather.Foggy": "Foggy",
        "weather.Light Rain": "Light Rain",
        "weather.Rain": "Rain",
        "weather.Thunder": "Thunder",
        "weather.Light Snow": "Light Snow",
        "weather.Snow": "Snow",
        "weather.Blizzard": "Blizzard",
        "weather.Cloudy": "Cloudy",
        "weather.Storm": "Storm",
        "weather.Fog": "Fog",
        # --- game commands ---
        "cmd.prefix": "!",
        "cmd.cooldown": "â³ Command cooling down, please try again in {seconds}s",
        "cmd.parse_in_progress": "â³ Save file is being parsed, please wait...",
        "cmd.player_not_found": "âŒ Player **{name}** not found in save data. Make sure you have logged in at least once.",
        "cmd.no_save_data": "âŒ No save data available. Save file has not been parsed yet.",
        "cmd.feature_disabled": "âŒ Game commands are currently disabled.",
        "cmd.unknown": "â“ Unknown command: `{command}`. Type `!help` for available commands.",
        "cmd.help.title": "ðŸ“– Available Commands",
        "cmd.help.description": "Type commands in game chat or Discord:",
        "cmd.help.coords": "`!coords` â€” Show your last saved coordinates",
        "cmd.help.stats": "`!stats` â€” Show your survival stats",
        "cmd.help.top": "`!top` â€” Survival days leaderboard",
        "cmd.help.kills": "`!kills` â€” Kill statistics leaderboard",
        "cmd.help.server": "`!server` â€” Server game state info",
        "cmd.help.help": "`!help` â€” Show this help message",
        "cmd.coords.title": "ðŸ“ Coordinates â€” {name}",
        "cmd.coords.value": "X: `{x:.0f}` | Y: `{y:.0f}` | Z: `{z:.0f}`",
        "cmd.coords.note": "âš ï¸ Coordinates are from the last save, not real-time.",
        "cmd.coords.parse_time": "ðŸ• Parsed at: {time}",
        "cmd.stats.title": "ðŸ“Š Stats â€” {name}",
        "cmd.stats.health": "â¤ï¸ Health: {health:.0f}",
        "cmd.stats.hunger": "ðŸ– Hunger: {hunger:.0f}",
        "cmd.stats.thirst": "ðŸ’§ Thirst: {thirst:.0f}",
        "cmd.stats.stamina": "âš¡ Stamina: {stamina:.0f}",
        "cmd.stats.infection": "ðŸ¦  Infection: {infection:.0f}",
        "cmd.stats.bites": "ðŸ©¸ Bites: {bites}",
        "cmd.stats.survival_days": "ðŸ“… Survived: {days} days",
        "cmd.stats.profession": "ðŸŽ­ Profession: {profession}",
        "cmd.top.title": "ðŸ† Survival Leaderboard â€” Top {limit}",
        "cmd.top.entry": "{rank}. **{name}** ({steam_id}) \u2014 {days} days",
        "cmd.top.no_data": "No player data available.",
        "cmd.server.title": "ðŸŒ Server Game State",
        "cmd.server.days_passed": "ðŸ“… Days Passed: **{days}**",
        "cmd.server.season_day": "ðŸ—“ï¸ Season Day: **{day}**",
        "cmd.server.players_in_save": "ðŸ‘¥ Players in Save: **{count}**",
        "cmd.server.last_parse": "ðŸ• Last Parse: {time}",
        # --- kills / challenges ---
        "cmd.kills.title": "ðŸ—¡ï¸ Kill Leaderboard â€” Top {limit}",
        "cmd.kills.entry": "{rank}. **{name}** â€” ðŸª¦ {zombies} kills ({headshots} headshots)",
        "cmd.kills.no_data": "No kill data available.",
        "cmd.stats.kills_summary": "ðŸª¦ Kills: {zombies} ({headshots} headshots)",
        "cmd.stats.fish": "ðŸŽ£ Fish Caught: {fish}",
        # --- RCON plain text (no emoji, short) ---
        "cmd.plain.coords": "[{name}] X:{x:.0f} Y:{y:.0f} Z:{z:.0f}",
        "cmd.plain.stats": "[{name}] HP:{health:.0f} Food:{hunger:.0f} Water:{thirst:.0f} Days:{days}",
        "cmd.plain.top_entry": "#{rank} {name} - {days}d",
        "cmd.plain.top": "Top {limit}: {entries}",
        "cmd.plain.server": "Server: {parts}",
        "cmd.plain.server.no_data": "No data",
        "cmd.plain.help": "Commands: !coords !stats !top !kills !server !help",
        "cmd.plain.kills_entry": "#{rank} {name} - {zombies}kills",
        "cmd.plain.kills": "Kill Top {limit}: {entries}",
        "cmd.plain.stats_kills": "Kills:{zombies} HS:{headshots}",
        # --- log / error ---
        "log.rcon_tcp_connected": "RCON TCP connected: %s:%d",
        "log.rcon_connect_failed": "RCON connection failed: %s:%d - %s",
        "log.rcon_auth_packet_sent": "Sent AUTH packet, id=%d",
        "log.rcon_auth_success": "RCON authentication successful",
        "log.rcon_auth_success_id": "RCON authentication successful (resp_id=%d)",
        "log.rcon_auth_failed": "RCON authentication failed: resp_id=%d",
        "log.rcon_auth_read_timeout": "AUTH read #%d timed out",
        "log.rcon_auth_no_response": "RCON authentication failed: no AUTH_RESPONSE received",
        "log.rcon_command_sent": "Sent command: %r (id=%d)",
        "log.rcon_read_error": "Error reading response: %s",
        "log.rcon_command_result": "Command %r: received %d packet(s), response length=%d",
        "log.rcon_connection_closed": "RCON connection closed",
        "log.rcon_connecting": "Attempting RCON connection: %s:%d",
        "log.rcon_connected": "RCON connection established",
        "log.rcon_reconnect_backoff": "RCON connection failed, next retry in %ds",
        "log.rcon_command_failed": "RCON command failed (%s): %s",
        "log.rcon_fetch_interrupted": "fetch_all interrupted: %s",
        "log.rcon_service_closed": "RconService connection closed",
        "log.player_log_not_found": "Log file not found: %s",
        "log.player_log_read_error": "Failed to read log file: %s",
        "log.player_time_parse_error": "Failed to parse time: date=%s time=%s",
        "log.player_not_found_in_log": "Players not found in log tail: %s",
        "log.chart_generation_failed": "Chart generation failed",
        "error.rcon_not_connected": "Not connected",
        "error.rcon_connection_closed": "Connection closed",
        "error.rcon_not_connected_call_connect": "Not connected, call connect() first",
        "log.rcon_connection_failed": "RCON connection failed",
    },
    "zh-TW": {
        "status.online": "ðŸŸ¢ ç·šä¸Š",
        "status.offline": "ðŸ”´ é›¢ç·š",
        "status.server_info": "ðŸ“‹ ä¼ºæœå™¨è³‡è¨Š",
        "status.season": "å­£ç¯€",
        "status.weather": "å¤©æ°£",
        "status.game_time": "éŠæˆ²æ™‚é–“",
        "status.connect_info": "ðŸ”— é€£ç·šè³‡è¨Š",
        "status.players": "ðŸ‘¥ çŽ©å®¶äººæ•¸",
        "status.online_players": "ç·šä¸ŠçŽ©å®¶",
        "status.ai_status": "ðŸ§Ÿ AI ç‹€æ…‹",
        "status.zombies": "æ®­å±",
        "status.bandits": "ç›œè³Š",
        "status.animals": "å‹•ç‰©",
        "status.system_status": "ðŸ“Š ç³»çµ±ç‹€æ…‹",
        "status.cpu": "è™•ç†å™¨",
        "status.memory": "è¨˜æ†¶é«”",
        "status.disk": "ç£ç¢Ÿ",
        "status.network": "ç¶²è·¯",
        "status.uptime": "å·²é‹è¡Œ",
        "status.death_count": "ðŸ’€ æ­»äº¡çµ±è¨ˆï¼ˆ{hours}hï¼‰",
        "status.death_count_value": "**{count}** æ¬¡çŽ©å®¶æ­»äº¡",
        "status.last_update": "æœ€å¾Œæ›´æ–°",
        "chat.joined": "ðŸ“¥ **{name}** åŠ å…¥äº†ä¼ºæœå™¨",
        "chat.left": "ðŸ“¤ **{name}** é›¢é–‹äº†ä¼ºæœå™¨",
        "chat.died": "ðŸ’€ **{name}** æ­»äº¡äº†",
        "chart.title": "çŽ©å®¶äººæ•¸ï¼ˆ24 å°æ™‚ï¼‰",
        "chart.ylabel": "äººæ•¸",
        "season.Spring": "æ˜¥å¤©",
        "season.Summer": "å¤å¤©",
        "season.Autumn": "ç§‹å¤©",
        "season.Fall": "ç§‹å¤©",
        "season.Winter": "å†¬å¤©",
        "weather.Clear": "æ™´æœ—",
        "weather.Partly Cloudy": "å¤šé›²æ™‚æ™´",
        "weather.Overcast": "é™°å¤©",
        "weather.Foggy": "å¤§éœ§",
        "weather.Light Rain": "å°é›¨",
        "weather.Rain": "ä¸‹é›¨",
        "weather.Thunder": "é›·é›¨",
        "weather.Light Snow": "å°é›ª",
        "weather.Snow": "ä¸‹é›ª",
        "weather.Blizzard": "æš´é¢¨é›ª",
        "weather.Cloudy": "å¤šé›²",
        "weather.Storm": "æš´é¢¨é›¨",
        "weather.Fog": "éœ§",
        # --- éŠæˆ²æŒ‡ä»¤ ---
        "cmd.prefix": "!",
        "cmd.cooldown": "â³ æŒ‡ä»¤å†·å»ä¸­ï¼Œè«‹ {seconds} ç§’å¾Œå†è©¦",
        "cmd.parse_in_progress": "â³ æ­£åœ¨è§£æžå­˜æª”ä¸­ï¼Œè«‹ç¨å€™...",
        "cmd.player_not_found": "âŒ åœ¨å­˜æª”ä¸­æ‰¾ä¸åˆ°çŽ©å®¶ **{name}**ã€‚è«‹ç¢ºèªä½ è‡³å°‘ç™»å…¥éŽä¸€æ¬¡ã€‚",
        "cmd.no_save_data": "âŒ æ²’æœ‰å¯ç”¨çš„å­˜æª”è³‡æ–™ã€‚å­˜æª”å°šæœªè¢«è§£æžã€‚",
        "cmd.feature_disabled": "âŒ éŠæˆ²æŒ‡ä»¤åŠŸèƒ½ç›®å‰å·²åœç”¨ã€‚",
        "cmd.unknown": "â“ æœªçŸ¥æŒ‡ä»¤ï¼š`{command}`ã€‚è¼¸å…¥ `!å¹«åŠ©` æŸ¥çœ‹å¯ç”¨æŒ‡ä»¤ã€‚",
        "cmd.help.title": "ðŸ“– å¯ç”¨æŒ‡ä»¤",
        "cmd.help.description": "åœ¨éŠæˆ²èŠå¤©æˆ– Discord ä¸­è¼¸å…¥æŒ‡ä»¤ï¼š",
        "cmd.help.coords": "`!ä½ç½®` â€” æŸ¥çœ‹ä½ æœ€å¾Œå­˜æª”çš„åº§æ¨™",
        "cmd.help.stats": "`!ç‹€æ…‹` â€” æŸ¥çœ‹ä½ çš„ç”Ÿå­˜ç‹€æ…‹",
        "cmd.help.top": "`!æŽ’è¡Œ` â€” å­˜æ´»å¤©æ•¸æŽ’è¡Œæ¦œ",
        "cmd.help.kills": "`!æ“Šæ®º` â€” æ“Šæ®ºçµ±è¨ˆæŽ’è¡Œæ¦œ",
        "cmd.help.server": "`!ä¼ºæœå™¨` â€” ä¼ºæœå™¨éŠæˆ²ç‹€æ…‹",
        "cmd.help.help": "`!å¹«åŠ©` â€” é¡¯ç¤ºæ­¤å¹«åŠ©è¨Šæ¯",
        "cmd.coords.title": "ðŸ“ åº§æ¨™ â€” {name}",
        "cmd.coords.value": "X: `{x:.0f}` | Y: `{y:.0f}` | Z: `{z:.0f}`",
        "cmd.coords.note": "âš ï¸ åº§æ¨™ç‚ºæœ€å¾Œä¸€æ¬¡å­˜æª”æ™‚çš„ä½ç½®ï¼Œéžå³æ™‚ä½ç½®ã€‚",
        "cmd.coords.parse_time": "ðŸ• è§£æžæ™‚é–“ï¼š{time}",
        "cmd.stats.title": "ðŸ“Š ç‹€æ…‹ â€” {name}",
        "cmd.stats.health": "â¤ï¸ è¡€é‡ï¼š{health:.0f}",
        "cmd.stats.hunger": "ðŸ– é£¢é¤“ï¼š{hunger:.0f}",
        "cmd.stats.thirst": "ðŸ’§ å£æ¸´ï¼š{thirst:.0f}",
        "cmd.stats.stamina": "âš¡ é«”åŠ›ï¼š{stamina:.0f}",
        "cmd.stats.infection": "ðŸ¦  æ„ŸæŸ“ï¼š{infection:.0f}",
        "cmd.stats.bites": "ðŸ©¸ å’¬å‚·ï¼š{bites}",
        "cmd.stats.survival_days": "ðŸ“… å·²å­˜æ´»ï¼š{days} å¤©",
        "cmd.stats.profession": "ðŸŽ­ è·æ¥­ï¼š{profession}",
        "cmd.top.title": "ðŸ† å­˜æ´»æŽ’è¡Œæ¦œ â€” å‰ {limit} å",
        "cmd.top.entry": "{rank}. **{name}** ({steam_id}) \u2014 {days} \u5929",
        "cmd.top.no_data": "æ²’æœ‰çŽ©å®¶è³‡æ–™ã€‚",
        "cmd.server.title": "ðŸŒ ä¼ºæœå™¨éŠæˆ²ç‹€æ…‹",
        "cmd.server.days_passed": "ðŸ“… å·²éŽå¤©æ•¸ï¼š**{days}**",
        "cmd.server.season_day": "ðŸ—“ï¸ å­£ç¯€å…§å¤©æ•¸ï¼š**{day}**",
        "cmd.server.players_in_save": "ðŸ‘¥ å­˜æª”ä¸­çŽ©å®¶æ•¸ï¼š**{count}**",
        "cmd.server.last_parse": "ðŸ• æœ€å¾Œè§£æžæ™‚é–“ï¼š{time}",
        # --- æ“Šæ®º/æŒ‘æˆ° ---
        "cmd.kills.title": "ðŸ—¡ï¸ æ“Šæ®ºæŽ’è¡Œæ¦œ â€” å‰ {limit} å",
        "cmd.kills.entry": "{rank}. **{name}** â€” ðŸª¦ {zombies} æ“Šæ®ºï¼ˆ{headshots} çˆ†é ­ï¼‰",
        "cmd.kills.no_data": "æ²’æœ‰æ“Šæ®ºè³‡æ–™ã€‚",
        "cmd.stats.kills_summary": "ðŸª¦ æ“Šæ®ºï¼š{zombies}ï¼ˆ{headshots} çˆ†é ­ï¼‰",
        "cmd.stats.fish": "ðŸŽ£ é‡£é­šï¼š{fish}",
        # --- RCON ç´”æ–‡å­—ï¼ˆç„¡ emojiã€ç°¡çŸ­ï¼‰ ---
        "cmd.plain.coords": "[{name}] X:{x:.0f} Y:{y:.0f} Z:{z:.0f}",
        "cmd.plain.stats": "[{name}] è¡€é‡:{health:.0f} é£¢é¤“:{hunger:.0f} å£æ¸´:{thirst:.0f} å¤©æ•¸:{days}",
        "cmd.plain.top_entry": "#{rank} {name} - {days}å¤©",
        "cmd.plain.top": "æŽ’è¡Œå‰{limit}: {entries}",
        "cmd.plain.server": "ä¼ºæœå™¨: {parts}",
        "cmd.plain.server.no_data": "ç„¡è³‡æ–™",
        "cmd.plain.help": "æŒ‡ä»¤: !ä½ç½® !ç‹€æ…‹ !æŽ’è¡Œ !æ“Šæ®º !ä¼ºæœå™¨ !å¹«åŠ©",
        "cmd.plain.kills_entry": "#{rank} {name} - {zombies}æ“Šæ®º",
        "cmd.plain.kills": "æ“Šæ®ºå‰{limit}: {entries}",
        "cmd.plain.stats_kills": "æ“Šæ®º:{zombies} çˆ†é ­:{headshots}",
        # --- log / error ---
        "log.rcon_tcp_connected": "RCON TCP é€£ç·šæˆåŠŸ: %s:%d",
        "log.rcon_connect_failed": "RCON é€£ç·šå¤±æ•—: %s:%d - %s",
        "log.rcon_auth_packet_sent": "é€å‡º AUTH å°åŒ…, id=%d",
        "log.rcon_auth_success": "RCON èªè­‰æˆåŠŸ",
        "log.rcon_auth_success_id": "RCON èªè­‰æˆåŠŸ (resp_id=%d)",
        "log.rcon_auth_failed": "RCON èªè­‰å¤±æ•—: resp_id=%d",
        "log.rcon_auth_read_timeout": "AUTH è®€å– #%d è¶…æ™‚",
        "log.rcon_auth_no_response": "RCON èªè­‰å¤±æ•—: æœªæ”¶åˆ° AUTH_RESPONSE",
        "log.rcon_command_sent": "é€å‡ºæŒ‡ä»¤: %r (id=%d)",
        "log.rcon_read_error": "è®€å–å›žæ‡‰æ™‚ç™¼ç”ŸéŒ¯èª¤: %s",
        "log.rcon_command_result": "æŒ‡ä»¤ %r: æ”¶åˆ° %d å€‹å°åŒ…, å›žæ‡‰é•·åº¦=%d",
        "log.rcon_connection_closed": "RCON é€£ç·šå·²é—œé–‰",
        "log.rcon_connecting": "å˜—è©¦å»ºç«‹ RCON é€£ç·š: %s:%d",
        "log.rcon_connected": "RCON é€£ç·šå·²å»ºç«‹",
        "log.rcon_reconnect_backoff": "RCON é€£ç·šå¤±æ•—ï¼Œä¸‹æ¬¡é‡è©¦å»¶é² %ds",
        "log.rcon_command_failed": "RCON æŒ‡ä»¤åŸ·è¡Œå¤±æ•— (%s): %s",
        "log.rcon_fetch_interrupted": "fetch_all åŸ·è¡Œä¸­æ–·: %s",
        "log.rcon_service_closed": "RconService é€£ç·šå·²é—œé–‰",
        "log.player_log_not_found": "æ—¥èªŒæª”æ¡ˆä¸å­˜åœ¨: %s",
        "log.player_log_read_error": "ç„¡æ³•è®€å–æ—¥èªŒ: %s",
        "log.player_time_parse_error": "ç„¡æ³•è§£æžæ™‚é–“: date=%s time=%s",
        "log.player_not_found_in_log": "ä»¥ä¸‹çŽ©å®¶åœ¨æ—¥èªŒå°¾ç«¯æ‰¾ä¸åˆ° Connected è¨˜éŒ„: %s",
        "log.chart_generation_failed": "ç”Ÿæˆåœ–è¡¨å¤±æ•—",
        "error.rcon_not_connected": "æœªå»ºç«‹é€£ç·š",
        "error.rcon_connection_closed": "é€£ç·šå·²é—œé–‰",
        "error.rcon_not_connected_call_connect": "æœªå»ºç«‹é€£ç·šï¼Œè«‹å…ˆå‘¼å« connect()",
        "log.rcon_connection_failed": "RCON é€£ç·šå¤±æ•—",
    },
}

_current_locale: str = "en"


def set_locale(locale: str) -> None:
    global _current_locale
    if locale not in _STRINGS:
        raise ValueError(f"Unsupported locale: {locale}. Available: {list(_STRINGS)}")
    _current_locale = locale


def t(key: str, **kwargs: Any) -> str:
    table = _STRINGS.get(_current_locale, _STRINGS["en"])
    text = table.get(key) or _STRINGS["en"].get(key, key)
    if kwargs:
        return text.format(**kwargs)
    return text
